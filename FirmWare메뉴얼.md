# POSCO Battery Management System
## 1.준비물
  - 테스트 배터리 모듈(16셀 카드리지)
  - 온도센서 2개( 연호 2PIN 용) 
	- 프로그래머(당사 제작) 
 <img src="./images/KakaoTalk_20250204_095505304.jpg" width="100" alt="프로그래머">

	- USB to 485 Converter , 당사제작 혹은 아무거나.   
    당사 제품을 이용할 경우 1:1 Ethernet Cable를 이용
	  (타사 제품을 이용할 경우 7: A, 8 B에 연결함. )
  <img src="./images/KakaoTalk_20250204_100002564.jpg" width="100" alt="USB to 485 Converter">   

	- Modpoll 프로그램 신규설치시 라이선스 부여해 준다.
	- 모드버스 라이선스 KEY (구매한 코드)
```
5A5742575C5D7A7F637071701E725C177B6176163D3B78707A1578717E7964783A3F03186542564B17595B5B555F405C3A3F5F4E535B5B525E58725F5D505A5519565D553D3B64706307060803010B14060D020A1D000A0804075C```
```
## 2. 프로그래머 연결

<img src="./images/KakaoTalk_20250204_121450725.jpg" width="500" alt="USB to 485 Converter">      

1. VS Code 실행
   - 실행 후 PosceT52FRM 프로젝트 폴더 열기
2. 프로그래머 연결
    - 프로그래머 연결 후 프로그래머 포트 확인
    - 프로그래머는 기본으로 COM5에 프로그래밍을 한다. 
    - 따라서 장치관리자를 열어 프로그래머의 포트를 COM5로 설정해 준다.
    - <장치관리자> -> <포트(COM 및 LPT)> -> <USB Serial Port (COM5)> -> <속성> -> <하위 포트> -> <포트 설정> -> <COM5>
3. 프로그래밍
    - 프로그래머 포트 확인 후 프로그래밍 버튼 클릭
    - Short key  < ctrl > + < alt > + u
## 3. Modbus를 이용한 센서보드의 설정
  * Modpoll 프로그램 실행
      - 통신 포트를 열고 < new > 버튼 클릭 하여 통신 포트를 연다. 
      - 최초 프로그램시 센서보드의 Modbus Address를 1로 설정된다.
  * Function 04로 설정하여 전압및 온도 전류를 읽는다.    
  데이터	( Read Input Registor)
	- 0~15 : 셀전압 -> 테스트 배터리의 실측값과 비교한다.
	- 16 : 온도 1  -> 현재의 실내 온도와 비교한다. 
	- 17 : 온도 2
	- 17 : 전류 ( 1번 모듈만 유효함) 
***
  - <img src="./images/스크린샷 2025-02-04 113323.png" width="300" alt="Modbus Address">   
  ### 데이터 설정 (  FC03,FC06)
  - **데이타 설정시 설치할 셀수, 모듈 수량, 모듈별 설치 수량을 설정한다.**   
    주문을 받을 때 이 값은 설정되며, 이에 따라 센서 보드를 구성한다.
  - 변경하고자 하는 데이터를 더블클릭하여 값을 변경한다.
	- 00 : modbus addresds  
      1번지 부터 시작한다. 
      Modbus 를 변경하면 센서모듈은 즉시 재 부팅되며 새로운 ID로 설정된다.
	- 01 : 설치된 셀수 
    * 설치된 셀수를 설정한다. 최대 16셀, 최소 5셀 
      * ex) 290셀 설치시 290/16=18.125,18*16=288, 290-288=2 로 설정한다.   
      따라서 이경우는 19개의 모듈이 필요하며,18번 모듈은 9셀, 19번 모듈은 9셀을 설정한다.
      * 위와 같이 셀이 5셀로 설정이 되면 9번 이후의 connector는 
        9번을 포함하여 16번까지 쇼트한다.  
      * 또한 현장 설치시 착오가 없게끔 하기 위하여 connector를 
      꽃을 수 없게 하기 위하여 Marking(Glue gun 혹은 테이프 등) 을 해둔다.
      * Lable 작성 후 부착   
        Modbus ID, 셀수, 버전를 라벨링한다.( SBM_x.x.xxx) 
      
	- 02 : 레퍼런스 전압
    * 기본값은 4096이다. 측정값의 오차를 보정한다.
      * 계산 수식
        * 측정값 = 측정값 * 레퍼런스 전압 / 4960
        * ex) 측정값 = 1000 * 4960 / 65536 = 75.5  mV    
            레퍼런스 전압을 50mV 로 설정할 경우    
            4960 + 50mV = 5010 ,
            1000 * 5010 / 65536 = 76.5 mV    
            즉 100mV정도를 더 높게 측정하게 된다
            
	- 03 : Gain 
    * reserved 
	- 04 : offset
    * reserved 
	- 05 : major version
	- 06 : minor version
	- 07 : patch version
